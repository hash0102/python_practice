## 10.1 OSの機能を利用する `os`
- Pythonの `os` モジュールは、UNIX/LinuxやWindowsなどのOSの機能をPythonから操作できるようにする標準ライブラリ。
- 特に **環境変数やプロセス属性（ユーザーID、グループID、プロセスID、優先度など）** にアクセス・制御する機能も備えている。

> ### 環境変数
>- **環境変数**は、オペレーティングシステム（OS）全体で共有される**名前と値のペア**
>   - プログラムが実行される環境に関する設定情報を提供する
> #### 特徴
> - **グローバルな情報**：システム上のどのプロセスからでもアクセスできる
> - **設定情報の提供**：プログラムが特定のファイルを探す場所（`PATH`）、ユーザー名（`USER`）、ホームディレクトリ（`HOME`）などを知るために使われる。
> - **永続性**：通常、システム起動時に設定され、ログインセッションが続く限り有効
> #### 例
> - 例えば、コマンドラインで「`ls`」と入力すると、OSは`PATH`という環境変数を参照して、`ls`コマンドがどこにあるかを探し出し、実行する。

> ### プロセス属性
>- **プロセス属性**は、**特定のプロセス（実行中のプログラム）だけが持つ情報**。
>   - これは、そのプロセス固有の状態や権限を定義する。
>#### 特徴
> - **ローカルな情報**：そのプロセス内でのみ有効で、他のプロセスには直接影響しない。
> - **プロセスの管理**：プロセスの識別子（`PID`）、親プロセスの識別子（`PPID`）、所有者（`UID`）、現在の作業ディレクトリ（`CWD`）などが含まれる。
> - **一時的**：プロセスが終了すると、そのプロセス属性も消滅する。
> #### 例
> - Webブラウザを開くと、そのブラウザは独自のプロセスとして動作し、固有の`PID`が割り当てられる
> - この`PID`は、そのブラウザプロセスを特定するために使われる
#### 違いのまとめ

|  | **環境変数** | **プロセス属性** |
| --- | --- | --- |
| **スコープ** | システム全体 | 特定のプロセスのみ |
| **用途** | プログラムが動作する**環境**の設定 | プロセス自体の**状態**や**管理** |
| **例** | `PATH`, `HOME`, `USER` | `PID`, `PPID`, `UID`, `CWD` |
- 環境変数が「**部屋の壁に貼られた共通のルール**」だとすると、
- プロセス属性は「**部屋にいる人それぞれが持っている名札や荷物**」

### 実行中のプロセス属性の操作
**例：os_module.py**

### **ファイルとディレクトリの操作**

**`os.chdir(path)`**
- **用途**: カレントディレクトリの変更
- **注意**: スクリプト全体の作業ディレクトリが変わる（注意して使う）

**`os.chmod(path, mode)`**
- **用途**: UNIX系のファイルパーミッション変更

**`os.chown(path, uid, gid)`（UNIX限定）**
- **用途**: 所有者とグループの変更

**`os.listdir(path='.')`**
- **用途**: ディレクトリ内の一覧を取得

**`os.makedirs(path, exist_ok=False)`**
- **用途**: 親ディレクトリも含めて再帰的に作成

**`os.remove(path)` と `os.rmdir(path)`**
- `remove`: **ファイルのみ**
- `rmdir`: **空ディレクトリのみ**

**`os.symlink(src, dst)`**
- **用途**: シンボリックリンクの作成

| **関数名** | **引数** | **解説** | **戻り値** | pathlibの同等 |
| --- | --- | --- | --- | --- |
| `os.chdir(path)` | `path`: 文字列| カレントディレクトリを変更する | なし | `Path().chdir()`（非対応） → `os.chdir(Path)`で代用 |
| `os.chmod(path, mode)`  | `path`: ファイル/ディレクトリのパス<br> `mode`: パーミッション（8進数）| ファイルやディレクトリのパーミッションを変更 | なし | `Path.chmod(mode)` |
| `os.chown(path, uid, gid)` | `path`: 対象パス <br>`uid`: ユーザーID<br>`gid`: グループID | 所有者とグループを変更（UNIX限定） | なし | `Path.chown(uid, gid)` |
| `os.getcwd()` | なし | 現在の作業ディレクトリを取得 | カレントディレクトリのパス（文字列） | `Path.cwd()` |
| `os.listdir(path='.')` | `path`: 対象ディレクトリ（省略可） | 指定パスにあるファイルとディレクトリの一覧 | ファイル/ディレクトリ名のリスト（文字列） | `Path.iterdir()`（リスト化が必要） |
| `os.mkdir(path, mode=0o777)` | `path`: 作成するディレクトリのパス<br>`mode`: パーミッション（省略可）| ディレクトリを1つ作成 | なし | `Path.mkdir()` |
| `os.makedirs(path, mode=0o777, exist_ok=False)` | `path`: ネストされたパス <br>`mode`: パーミッション<br>`exist_ok`: 既存時エラー抑制 | ネストされたディレクトリを再帰的に作成 | なし | `Path.mkdir(parents=True)` |
| `os.remove(path)` | `path`: 削除するファイル | ファイルを削除 | なし | `Path.unlink()` |
| `os.removedirs(path)` | `path`: 空のディレクトリを再帰的に削除 | 全て空であればディレクトリ階層を削除 | なし | 手動再帰的削除が必要 |
| `os.rename(src, dst)` | `src`: 元ファイル/ディレクトリ <br>`dst`: 新ファイル/ディレクトリ | リネーム（または移動） | なし | `Path.rename()` |
| `os.renames(old, new)` | `old`: 元のパス <br>`new`: 新しいパス | `rename()` + 必要な親ディレクトリ作成 + 空なら元ディレクトリ削除 | なし | 複雑動作のためpathlibに同等なし |
| `os.rmdir(path)` | `path`: 空のディレクトリ | 空のディレクトリを削除 | なし | `Path.rmdir()` |
| `os.symlink(src, dst, target_is_directory=False)` | `src`: リンク先 <br>`dst`: リンク名<br>`target_is_directory`: ディレクトリならTrue（Windows向け） | シンボリックリンク作成 | なし | `Path.symlink_to()` |

**例：os_file_dir.py**

### 様々なシステム情報へのアクセス

**`os.confstr(name)`**
- **用途**: システムの構成文字列（パスや制限値など）を取得（POSIX準拠）。
- **引数**:
    - `name`：`confstr_names` にある名前または整数キー
- **戻り値**： 対応する構成値の **文字列**（なければ `None`）

**`os.confstr_names`**
- **用途**: `confstr()` で使えるキーの一覧（辞書形式）

**代表的なキー**（OSにより異なる）:

| キー名 | 意味 |
| --- | --- |
| `'CS_PATH'` | デフォルトのPATH |
| `'CS_GNU_LIBC_VERSION'` | glibcバージョンなど（Linux） |
| `'CS_HOSTNAME'` | ホスト名（Linuxでは非対応） |

※   `confstr` は UNIX系のみ対応。Windowsでは利用できない

**`os.sysconf(name)`**
- **用途**: **システムの構成数値**（制限値、サイズ、リソースなど）を取得。
- **引数**: `sysconf_names` にあるキー名 or 整数
- **戻り値**: 数値（int）or `1`（無効）

**`os.sysconf_names`**
- **用途**: `sysconf()` に使えるキーの一覧（辞書）

**代表的なキー（Linuxなど）**
| キー名 | 意味 |
| --- | --- |
| `'SC_ARG_MAX'` | コマンドラインの最大長 |
| `'SC_OPEN_MAX'` | 同時オープン可能なファイル数 |
| `'SC_NPROCESSORS_CONF'` | 論理CPU数（システム全体） |
| `'SC_NPROCESSORS_ONLN'` | オンラインの論理CPU数（現在） |
| `'SC_PAGE_SIZE'` | メモリページサイズ（バイト） |
| `'SC_CLK_TCK'` | 1秒あたりのクロックチック数 |

**`os.cpu_count()`**
- **用途**: 利用可能な **CPU（論理プロセッサ）数**を取得
- **戻り値**: `int` or `None`（取得できない場合）
- **注意**: 論理CPU数（ハイパースレッディング含む）
- **`os.sysconf('SC_NPROCESSORS_ONLN')`** でも同様の値を取得可能

**`os.getloadavg()`**
- **用途**: システムの **平均負荷（Load Average）** を取得（UNIX限定）
- **戻り値**: タプル `(1分, 5分, 15分)` の浮動小数点数

- **意味**:
    - `1分`: 最近の負荷
    - `5分`: 短期トレンド
    - `15分`: 長期トレンド
    - 1.0 は「1つのCPUが常時使用中」を意味する（CPU数によって解釈が変わる）
- **注意**: **`os.cpu_count()`以外はWindowsでは利用不可**

**`os.urandom()`**
- OSが提供する乱数生成機能を用いて生成したランダムなbytesオブジェクトを返す
    - Unix系OSとWIndowsのどちらでも利用可能

**例：os_access.py**

## 10.2 ストリームを扱う io

### インメモリなテキストストリームを扱う `StringIO`

- `StringIO` は Python の `io` モジュールにあるクラスで、**文字列をファイルのように扱える**仮想のファイルオブジェクト
- メモリ上でファイル操作をエミュレートできるので、**一時的な文字列操作やテスト、入出力のモック**などに便利
- `io.StringIO` は **文字列 (`str`) 用の in-memory（メモリ内）ストリーム** 
- 書き込んだ文字列は内部バッファに保持され、後で読み取り可能。
- バイナリ用の `BytesIO` もあるが、`StringIO` はテキスト専用

**主なメソッドと使い方**

| 関数名 | 説明 |
| --- | --- |
| `.read(size=-1)` | 指定バイト数（または全体）の文字列を読み取る |
| `.write(s)` | 文字列を書き込む |
| `.tell()` | 現在のカーソル位置を取得 |
| `.seek(pos)` | カーソル位置を指定位置に移動 |
| `.getvalue()` | バッファにある全データ（文字列）を返す |
| `.close()` | ストリームを閉じて使用不能 |

**`class StringIO([initial_value])`**
- **引数**: 初期値（任意）

**`.write(s)`**
- **用途**: 文字列を書き込む（現在のカーソル位置から）
- **戻り値**: 書き込んだ文字数

**`.read(size=-1)`**
- **用途**: ストリームから文字列を読み取る（カーソル位置から）
- **引数**:
  - `size`: 読み取る最大文字数（省略時は全体）
- **戻り値**: 読み取った文字列

**`.seek(pos, whence=0)`**
- **用途**: カーソルを指定位置に移動
- **引数**:
  - `pos`: オフセット
  - `whence`: 基準（0=先頭, 1=現在位置, 2=末尾）

**`.tell()`**
- **用途**: 現在のカーソル位置を返す

**`.getvalue()`**
- **用途**: 内部バッファの全内容（全文字列）を返す
- **注意**: `.read()` や `.seek()` に影響されず、**常に全体が返る**

**`.close()`**
- **用途**: ストリームを閉じる。以後は読み書き不可。

**例：stringIO_module.py**

### インメモリなバイナリストリームを扱う `BytesIO`

- `BytesIO` は Python の `io` モジュールにあるクラスで、**バイト列（`bytes`）をメモリ上でファイルのように扱う仮想ファイル**。
- `StringIO` の **バイト版**で、バイナリデータを扱う場面（画像、PDF、ネットワーク通信、圧縮ファイルなど）でよく使われる。
- `io.BytesIO` は、`bytes` オブジェクトをファイルのように読み書きできる **in-memory binary stream**。
- データは RAM 上に保持され、ファイルアクセスなしで高速な読み書きが可能。
- 書き込みは `.write(b"データ")` など、**必ず `bytes` オブジェクト**を使用。

※Pythonで `b"文字列"` のように書くと、「**バイト列（`bytes`型）**」になる

**`BytesIO([initial_bytes])`**
- **説明**: 初期バイト列（省略可）でオブジェクトを作成

**`.write(bytes)`**
- **説明**: バイナリデータ（`bytes`）を書き込む
- **戻り値**: 書き込んだバイト数

**`.read(size=-1)`**
- **説明**: 現在のカーソル位置からバイト列を読み取る
- **引数**: `size` は最大読み取り数。省略時は最後まで。
- **戻り値**: 読み取った `bytes`

**`.tell()`**
- **説明**: カーソル位置（現在の読み書き位置）を取得
- **戻り値**: `int`

**`.seek(pos, whence=0)`**
- **説明**: カーソルを移動する
- **引数**:
  - `pos`: 移動量（バイト単位）
  - `whence`: 基準位置
    - `0`: 先頭から（デフォルト）
    - `1`: 現在位置から
    - `2`: バッファの末尾から

**`.getvalue()`**
- **説明**: バッファ内の全データを `bytes` で返す
- **戻り値**: `bytes`

**`.getbuffer()`**
- **説明**: メモリ上のバッファに対する **メモリビュー（memoryview）** を返す
- **用途**: バッファの一部を変更したいときや、ゼロコピー処理で高速アクセスしたいとき
- **戻り値**: `memoryview`

**`.close()`**
- **説明**: ストリームを閉じる（以後の read/write はエラー）

**例：BytesIO_module.py**

#### BytesIO vs StringIO
| 項目 | **`BytesIO`** | **`StringIO`** |
| --- | --- | --- |
| データ型 | `bytes`（バイナリ） | `str`（文字列） |
| 用途 | 画像、ファイル、圧縮等 | テキスト、ログ、CSVなど |
| 書き込み関数 | `.write(b"abc")` | `.write("abc")` |
| 読み取り関数 | `.read()` → `bytes` | `.read()` → `str` |
| メモリビュー取得 | `.getbuffer()` 可能 | ✖ なし |

### ioモジュールをユニットテストで活用する

- `io` モジュールは、Pythonのユニットテストにおいて「ファイルの代替」や「標準入出力の模倣」を行うために非常に有用。
- `io.StringIO` や `io.BytesIO` を使えば、**実際にファイルを作成せずに**仮想的なファイルを扱うことができ、**I/O処理のテストを高速かつ安全に行う**ことができる。

- 例えば次のような関数があるとする：

```python
def greet(name):
    print(f"Hello, {name}!")
```

- この関数は `print()` を使って標準出力にメッセージを出力する。
- **この出力内容を検証したい**場合に、`io.StringIO` を使って `sys.stdout` を一時的に差し替え、内容をキャプチャするのが定番の方法。
※ `pytest`で実行する

**例：IO_module_unittest.py**

## 10.3 インタープリターにかかわる情報を取得・操作する `sys`

### コマンドライン引数を取得する `argv`
- `sys.argv` は、**スクリプトの実行時に渡された引数の一覧を格納**したリスト。
- 最初の要素 (`sys.argv[0]`) は、**スクリプト名（またはパス）。**
  - それ以降の要素が、**コマンドライン引数。**

| 項目 | 内容 |
| --- | --- |
| 所属モジュール | `sys` |
| 型 | `list[str]` |
| `argv[0]` | スクリプト名や実行ファイルのパス |
| `argv[1:]` | 実際のコマンドライン引数 |
| 使いどころ | コマンドラインツール、CLI引数の処理 |
| 注意点 | 引数はすべて **文字列型 (`str`)** で渡される |

### ライブラリのインポートパスを操作する `path`

- `sys.path` は、Python が **モジュール（ `.py` ファイルなど）をどこから探すか** を管理するためのリスト。
- インポート文（`import モジュール名`）が使われたとき、**Python はこの `sys.path` の順番に従って、指定されたモジュールを探す**。

```python
import sys
print(sys.path)
```

- **`sys.path` は`list[str]` 型**。
  - Python インタープリタがモジュールを検索する「パス一覧」が格納されている。
- **読み取り・追加・削除・並び替え**が可能。

**`sys.path` に含まれるもの（順序あり）**
1. **スクリプトが存在するディレクトリ**（または空文字列 `''`）
2. **環境変数 `PYTHONPATH` で指定されたディレクトリ**
3. **標準ライブラリのパス**
4. **`site-packages` ディレクトリ**（pip でインストールされた外部パッケージなど）

**モジュールの探索に使われる順番**
- Python は次のようにモジュールを探す：

```python
import my_module
```

1. `sys.path[0]` から順に `my_module.py` または `my_module/__init__.py` を探す
2. 見つかればそれを読み込む
3. 見つからなければ `ModuleNotFoundError` を出す

**動的にパスを追加したい場合**
- パスの追加方法：

```python
import sys
sys.path.append("/path/to/my/modules")
```

- **末尾に追加される**（検索優先度は低い）
- 優先度を高くしたい場合は `insert(0, path)` を使う：

```python
sys.path.insert(0, "/my/high_priority_module")
```

**使い所：自作のモジュールや外部のプロジェクトをインポートしたいとき**

```python
# ディレクトリ構成:
# project/
# ├── main.py
# └── utils/
#     └── helper.py

# main.py で helper.py を使いたい場合
import sys
sys.path.insert(0, "./utils")
import helper
```
**※注意点**

| 注意項目 | 内容 |
| --- | --- |
| 永続化されない | `sys.path.append()` などの変更は **実行中のみ有効**。終了すると元に戻る。 |
| 絶対パス推奨 | 相対パスよりも `os.path.abspath()` を使って絶対パスで管理する方が安全。 |
| 他のモジュールと衝突 | 同名のモジュールが他の場所にあると意図せぬモジュールが読み込まれることがある。 |

### プログラムを終了する `exit()`

- `sys.exit()` は、**Pythonプログラムを任意の時点で終了させるための関数**。
- 通常、エラー発生時や条件を満たさないときに **明示的に終了**させる目的で使う。

```python
import sys
sys.exit([status])
```

- `status`: 省略可。終了コードを指定（整数 or 文字列 or その他のオブジェクト）
    - デフォルトは `0`（正常終了）

**引数と意味**

| 引数の種類 | 例 | 意味 |
| --- | --- | --- |
| 省略 | `sys.exit()` | 正常終了（`0`） |
| 整数 | `sys.exit(1)` | 異常終了（`1` = エラー） |
| 文字列 | `sys.exit("エラー")` | 異常終了、文字列が `stderr` に出力される |
| その他のオブジェクト | `sys.exit(SomeObj)` | `SystemExit` 例外として渡される |
- `sys.exit()` は内部的に何をしているのか？
    - 実際には、**`SystemExit` 例外を送出**します。

```python
raise SystemExit([status])
```

- つまり、Python において `sys.exit()` は例外処理の一部で、キャッチも可能：

```python
try:
    sys.exit("終了します")
except SystemExit as e:
    print("キャッチされた:", e)
```

**終了コードと意味（OSレベル）**

| 終了コード | 意味 | OS に通知される終了状態 |
| --- | --- | --- |
| `0` | 正常終了 | 成功として扱われる |
| `1`以上 | 異常終了 | エラー、失敗などを示す |
- UNIX やシェルスクリプトではこのコードを使ってフロー制御をすることが多い。

- **注意点**

| **注意点** | **説明** |
| --- | --- |
| `sys.exit()` は例外を発生させる | `SystemExit` は `BaseException` のサブクラスなので、通常の `except Exception` ではキャッチされない |
| `finally` ブロックは実行される | `sys.exit()` の直前に `finally` ブロックがあると、それは実行される |
| GUI や Web アプリでは使わない | Flask, Django, Tkinter などでは使うと不正終了になる可能性がある（代替手段を使う） |

**例：sys_module.py**

### コンソールの入出力を扱う `stdin`・`stdout`・`stderr`

- Python の `sys.stdin`・`sys.stdout`・`sys.stderr`は、**標準入力・標準出力・標準エラー出力**を操作するためのファイルライクオブジェクト。
- これらは OS レベルの入出力ストリームに対応しており、**コマンドラインツールやスクリプトの入出力制御**において非常に重要。

| オブジェクト | 役割 | デフォルトの接続先 |
| --- | --- | --- |
| `sys.stdin` | 標準入力 | キーボード or リダイレクトされた入力 |
| `sys.stdout` | 標準出力 | ターミナル or 出力先にリダイレクト |
| `sys.stderr` | 標準エラー出力 | ターミナル（`stdout` とは別） |

#### **`sys.stdin`（標準入力）**
- ユーザーの入力やファイルからの入力を読み取るために使う。
  - `.read()`, `.readline()`, `.readlines()` などのメソッドを持つ。

#### `sys.stdout`（標準出力）
- **`print()`** は内部的に **`sys.stdout.write()`** を使って出力している。
- ファイルにリダイレクト可能。

#### `sys.stderr`（標準エラー出力）
- エラーや警告を表示するための出力ストリーム。
- `sys.stdout` と独立しているため、出力先を分けることができる。
  - `.write()` で出力。

**実行時の入出力の使い分け**

| 使用場面 | 推奨ストリーム |
| --- | --- |
| 通常の出力 | `sys.stdout` |
| ユーザーへの入力待ち | `sys.stdin` |
| エラーや警告の表示 | `sys.stderr` |
| ログやデバッグ出力 | `sys.stderr`（または logging） |
| テスト中の出力キャプチャ | `StringIO` で差し替え |

**よく使うメソッド**

| ストリーム | メソッド | 説明 |
| --- | --- | --- |
| `sys.stdin` | `.read()` | 全体を読み込む |
|  | `.readline()` | 一行読み込む |
|  | `.readlines()` | 複数行をリストで |
| `sys.stdout` | `.write(str)` | 出力文字列を書き込む |
| `sys.stderr` | `.write(str)` | エラー文字列を書き込む |
| すべて | `.flush()` | バッファを強制出力 |

**注意点**

| 注意項目 | 内容 |
| --- | --- |
| バッファリング | 出力はすぐに表示されない場合がある（特に `.write()` 後は `.flush()` 推奨） |
| デコード | `sys.stdin.read()` は `str`（テキスト）で読み取る。バイナリが必要なら `sys.stdin.buffer` を使う |
| `input()` との違い | `input()` は `sys.stdin.readline()` とほぼ同等だが、末尾の `\n` を自動削除する点が違う |

**例：sys_module2.py**

### `breakpoint()`実行時のフック関数 `breakpointhook()`

- `sys.breakpointhook()` は、Python の組み込み関数 `breakpoint()` の動作をカスタマイズするための **フック関数（hook）** 。
- `breakpoint()` は、プログラムの実行を一時停止し、**インタラクティブなデバッガ**を起動するための関数
- その内部では、実際には `sys.breakpointhook()` を呼び出している

つまり：

```python
breakpoint()
```

は内部的にこう動いている：

```python
import sys
sys.breakpointhook()
```

#### `pdb`とは
- `pdb` は Python **標準搭載のデバッガ**（Python Debugger）
- コードの実行を途中で止めて、ステップ実行・変数確認・関数呼び出しの追跡などができる
- 外部ライブラリ不要で、Python に最初からついている公式デバッガ

**`pdb` の主な用途**

- コードの実行途中で止める
- 変数の中身を見る
- 1行ずつステップ実行する
- 関数呼び出しを追跡する
- スタックトレースを調べる

デバッグのための「対話型シェル」が実行時に現れるイメージ

**よく使う pdb コマンド**
- **`n`**	：次の行へ（step over）
- **`s`**	：関数の中へ入る（step into）
- **`c`**	：次のブレークポイントまで実行
- **`l`** ：ソースコード表示（list）
- **`p 変数`**：値を表示（print）
- **`q`**	：デバッガ終了

**カスタマイズ：`sys.breakpointhook` を上書き**
- `sys.breakpointhook()` を任意の関数に差し替えることで、`breakpoint()` の動作を自由に変えることができる。

**`PYTHONBREAKPOINT` 環境変数との関係**
- `breakpoint()` の動作は、環境変数 `PYTHONBREAKPOINT` によっても制御できる。

| **値** | **動作** |
| --- | --- |
| 未設定 または `pdb.set_trace` | 標準のデバッガを使用（pdb） |
| `0` または `""` | `breakpoint()` は無効になる |
| `<モジュール>.<関数>` | その関数が `sys.breakpointhook` の代わりに使われる |

**breakpoint を完全に無効化**
```bash
export PYTHONBREAKPOINT=0
python script.py
```

 **シグネチャと仕様**

```python
sys.breakpointhook(*args, **kwargs)
```

- 通常は引数なしで呼び出される。
    - 引数を渡したい場合、自分で `breakpoint()` に引数を渡すと、`breakpointhook` にも渡される。

**注意点**

| **注意点** | **内容** |
| --- | --- |
| `sys.breakpointhook()` を直接呼び出すべきではない | 通常は `breakpoint()` を通じて使う |
| Python 3.6 以前には存在しない | バージョン確認が必要 |
| `PYTHONBREAKPOINT` が優先される | 実行時の環境変数が関数の上書きを無効化する可能性あり |
| テスト中に `breakpoint()` を使うと止まってしまう | `sys.breakpointhook` をモックするのが安全 |

**例：sys_module3.py**

### Pythonのバージョン番号を調べる `version_info`

- `sys.version_info` は、**現在実行中の Python のバージョン情報を取得**するための定数。
- Python スクリプトの中で、実行環境の Python のバージョンに応じて動作を切り替えたいときに使われる

```python
import sys
print(sys.version_info)
```

**出力例（Python 3.11 の場合）：**

```
version_info(major=3, minor=11, micro=4, releaselevel='final', serial=0)
```

- これは 名前付きタプル（`sys.version_info` オブジェクト）で、以下のような属性を持つ

**属性一覧**

| 属性名 | 意味 | 例（Python 3.11.4） |
| --- | --- | --- |
| `major` | メジャーバージョン（大きな変更） | `3` |
| `minor` | マイナーバージョン（機能追加など） | `11` |
| `micro` | バグ修正などの小規模な変更 | `4` |
| `releaselevel` | リリースレベル（開発段階） | `'final'` |
| `serial` | リリース番号 | `0` |

- `sys.version_info` は比較可能なオブジェクトで、**タプルのように使える**。
- `(3, 10)` のように **前から順に比較される**ため、比較式が直感的。

**属性アクセスとインデックスアクセス**

| --- | --- |
| 属性アクセス | `sys.version_info.major` |
| インデックス | `sys.version_info[0]` |

- 両方同じだが、**属性名を使うほうが読みやすく推奨**される。

**`releaselevel` の意味**

| 値 | 意味 |
| --- | --- |
| `'alpha'` | アルファ版（初期テスト） |
| `'beta'` | ベータ版（機能ほぼ確定） |
| `'candidate'` | リリース候補（RC） |
| `'final'` | 正式リリース |

- この値は、プレリリース版などをチェックする場合に使われる。

**`sys.version` との違い**

| オブジェクト | 内容 |
| --- | --- |
| `sys.version_info` | 構造化されたバージョン情報（比較しやすい） |
| `sys.version` | 単なる文字列（表示目的） |

**例：sys_module4.py**

### コマンドオプション・引数を扱う `argparse`

#### コマンドラインオプションを扱う

- `argparse`モジュールは、**Python 標準のコマンドライン引数パーサー**で、スクリプトに**オプションや引数を柔軟に渡せるようにするため**のツール。
- CUIツールを作る際に非常に重宝される

**`ArgumentParser`の初期化引数**

| 引数名 | 説明 |
| --- | --- |
| `prog` | プログラム名（`%(prog)s` として `usage` などに使用） |
| `usage` | 使用方法メッセージのカスタム。省略時は自動生成 |
| `description` | `--help` の最初に表示される説明文 |
| `epilog` | `--help` の最後に表示される補足文 |
| `parents` | 他の `ArgumentParser` インスタンスを継承（オプションの共通化） |
| `formatter_class` | ヘルプメッセージの整形クラス例：`ArgumentDefaultsHelpFormatter` でデフォルト値も表示 |
| `prefix_chars` | オプション引数の接頭文字（デフォルトは `-`） |
| `fromfile_prefix_chars` | ファイルから引数を読み込むときの接頭文字（例：`@args.txt`） |
| `argument_default` | `add_argument()` で指定されない場合のデフォルト値 |
| `conflict_handler` | 同じ引数名がある場合の処理（`error` または `resolve`） |
| `add_help` | `-h/--help` を自動追加するか（False にすると自分で定義が必要） |
| `allow_abbrev` | オプションの省略形を許可するか（例：`--ver` → `--verbose`） |
| `exit_on_error` | パースエラー時に `SystemExit` で終了するか（False にすると例外を投げる） |


**`-h` を指定した場合**
- `ArgumentParser` は初期化引数 `add_help=True` （デフォルト）だと、自動で `-h` と `--help` オプションが追加される。
  - このオプションを指定すると、**自動的にヘルプメッセージが表示され、プログラムは終了**する。

**`-h`の実行例**
```
python3 ./argparse_module5.py -h
usage: argparse_module5.py [-h] -n NAME -s SCORE

名前とスコアを受け取るスクリプト

options:
  -h, --help         show this help message and exit
  -n, --name NAME    ユーザーの名前
  -s, --score SCORE  スコア（整数）
```
- `h` または `-help` を指定するとここに示されたヘルプが表示される
- ヘルプ表示後、**プログラムは自動終了**（`SystemExit` が発生）

**`add_argument()` の主な引数について**
- `add_argument()` は、パーサーに受け付ける引数（オプション、位置引数）を定義するメソッド

| 引数名 | 説明 | 例 |
| --- | --- | --- |
| `name` / `flags` | 位置引数名またはオプションの名前（`-n`, `--name` など） | `"-n"`, `"--name"` |
| `action` | 引数をどう扱うか（値を保存、フラグ、カウントなど） | `"store"`（デフォルト）、`"store_true"` |
| `default` | 指定がなかった場合のデフォルト値 | `"anonymous"` |
| `type` | 引数の型変換関数 | `int`, `float`, `str` |
| `choices` | 指定できる値のリストや集合 | `["red", "green", "blue"]` |
| `required` | オプションの場合、必須かどうか | `True` / `False` |
| `help` | ヘルプメッセージで表示される説明文 | `"ユーザーの名前"` |

**よく使う例**

```python
parser.add_argument(
    "-n", "--name",            # オプション名（短縮形と長い形）
    help="ユーザーの名前",      # ヘルプに表示される説明
    required=True,             # 必須
    type=str,                  # 型は文字列（デフォルト）
    metavar="NAME"             # ヘルプで引数名を NAME と表示
)
```

- `required=True` は、オプションでも必須になる（指定しないとエラー）
- `type` は、入力値を自動で型変換する（例: `int` にすれば整数変換）
- `metavar` は、ヘルプの `[NAME]` 部分を指定した文字列に変更

**例：argparse_module5.py**