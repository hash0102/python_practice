## 1.1 Pythonパッケージを管理 pip

### pipの機能
1. **PyPIに公開されている**Pythonパッケージの**インストール**
2. インストールしたPythonパッケージの**アンインストール**
3. インストールしたパッケージの**アップグレード** 

### 導入方法
- **ensurepipモジュール**をインストールすることでpipをインストールできる
```bash
$ python -m ensurepip
```
- **Debian**、**Ubuntu**には**ensurepipモジュールがない**ため、**apt**で**python3-pip**というパッケージをインストールする
```bash
$ sudo apt install -y python3-pip
```

### 基本的な使い方
- 「**`pip install パッケージ名`**」というコマンドでインストールを行う
    - 特定のバージョンのパッケージをインストールしたい場合は「**`== バージョン番号`**」を付ける。
```bash
$ pip install sampleproject== 1.20
```
- **特定の範囲のバージョンの中で最新のもの**をインストールしたい場合は「`”パッケージ名**≥= 下範囲のバージョン, < 上範囲のバージョン"**`」を付ける。
```bash
$ pip install "sampleproject>=1.2.0,<2.0.0"
```
- **アップグレード**を行う場合は「**`pip install -U パッケージ名`**」（または「`pip install --upgrade パッケージ名`」）コマンドを実行
    - **バージョンを指定することで特定のバージョンにダウングレードもできる**
```bash
$ pip install -U パッケージ名 == ダウングレードしたいバージョン
```
    
- パッケージのアンインストールするには「`pip **uninstall** パッケージ名`」を実行

### requriments.txtを作って、複数の環境でバージョン統一

- pipでは**パッケージ名とバージョン番号を指定したテキストファイル**を用意することで、**バ－ジョンを統一**できる。
- テキストファイル名は慣例として「**requirements.txt**」が作られる。
    - **requirements.txt**は「**`pip freeze > requirement.txt`**」コマンドを実行して作成する
- **requiements.txt**を参照してパッケージをインストールするには「**`pip install -r requirements.txt`**」を実行する

### -c オプション

- 「**`pip install -r requirements.txt`**」に **-cオプション**を追加することで、requirements.txtでインストールされるパッケージの**バージョンに制限**をかけられる。
- **-cオプション**には**パッケージ名とバージョン番号を書いたテキストファイルを指定**する
- **書き方はrequirements.txtと同じ**で、ファイル名は慣例として「**constraint.txt**」が使われる
- 以下の二つの条件を満たす場合に使用を検討
    - 複数のアプリケーションを開発している
    - すべてのアプリケーションで特定パッケージのバージョンを統一したい
- **requirements.txtとconstraint.txtは単体では使えない**。
- constraint.txtはrequirements.txtに同じ名前のパッケージがある場合のみ、インストールできるバージョンに制限をかける。
    - **requirements.txtに名前がない**場合は**contraint.txtのパッケージインストールされない**
``` bash
$ pip install -r requirements.txt -c constraints.txt
```

### よくある使い方

- サードパーティのPythonパッケージに依存しているプログラムを書く際に対象のパッケージをインストールする
- パッケージ名、バージョン番号を書いたrequirements.txtを用意して、どの環境でも同じPythonパッケージを利用できるようにする

## 1.2 仮想環境の作成 `venv`

### 仮想環境とは

- **pythonコマンド**や**pipコマンド**を使ったPythonパッケージのインストール先など、**Pythonの実行環境を独立した領域に分離**するための仕組み
  - venvの仮想環境は**Dockerとは異なる**
- pipを使用してPythonパッケージのインストールをすると**デフォルトではシステム全体で利用できる領域にインストールされる**
  - システム全体で参照する領域を使用すると開発時に困ったことが起こる。
  - pipでは**1つの環境にインストールできるPythonパッケージのバージョンは1つだけ**なので、**２つのバージョンの同じパッケージを共存させることができない**（上書きすることになる。）
  - つまり、システム全体で参照する領域をインストール先にする場合は、開発前にインストールされているパッケージのバージョンを確認し、バージョンが違っていればインストールしなおす煩雑な作業を行わなければならない
- これを避けるため、Pythonでは**venvで仮想環境を作成し、アプリケーションごとに環境を分ける**ことができる

### 基本的な使い方

1. **仮想環境の作成**
- **venvモジュール**をpythonコマンドの`-m`オプションに指定して、スクリプトとして実行する
  - **`python -m venv`** の後ろに**ディレクトリ名**を指定すると、そのディレクトリの中に仮想環境が作成される。
``` bash
$ python3 -m venv env
```                
- python_1ディレクトリに**仮想環境**を作成する
- 仮想環境のディレクトリには仮想環境を利用する際に必要なファイル、ファイルへのリンク、ディレクトリが作られる
- **pythonコマンドのバージョンはvenv実行時に使ったpythonのバージョンと同じ**になる

1. **仮想環境の有効化**
   - 仮想環境は有効化することで利用できる。
     - 有効化するコマンドはOSやshellによって異なる
- 例：Windows（PowerShell）

```bash
.\env\Scripts\Activate.ps1
```

- 例：macOS / Linux（bash / zsh）
```bash 
source env/Scripts/activate
```
- Windowsで仮想環境を作成した場合は**Scriptsディレクトリ**が作成され、Linuxの場合は**binディレクトリ**が作成される

2. **仮想環境の無効化**
- 仮想環境の利用が終わったら、**`dectivate`コマンド**で無効化する
    - 無効化するとシステム共通の環境に戻るため、仮想環境のコマンドやインストールしたパッケージが参照できなくなる。

```bash
$ deactivate 
```

- **仮想環境の削除**
    - 不要になった仮想環境を削除したい場合は「**`python -m 仮想環境のディレクトリ`**」で作成したディレクトリごと削除
- 例：PowerShell
```powershell
Remove-Item -Recurse -Force env
```
- 例：Linux
```bash
$ rm -rf env
```

**仮想環境を作りなおす**
- `pip uninstall`コマンドは依存関係にあるパッケージは削除できず、**依存関係も含めて削除したい**場合は、**仮想環境を作り直すことで作業を簡略化**できる

### venvのよくある使い方
- アプリケーション開発時に**仮想環境を作成**し、Pythonパッケージのインストール先に独立した領域を使う
- Pythonパッケージの使い方の調査を仮想環境上で行い、調査が終了したら仮想環境ごと削除する