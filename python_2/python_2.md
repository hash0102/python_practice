## 2.1 Python標準のスタイルガイド `PEP8`

### PEP8で定義されているルール
- **コードのレイアウトに関するルール**
- **コメントに関するルール**
- **命名規則に関するルール**

### コードのレイアウト
1. **インデント**
   - PEPでのインデントは**スペース４つ**
      - リストや辞書、関数の引数など、カッコ内部で改行した場合のインデントは、いくつかのパターンがある
      - **折り返された引数や値を縦に揃える**ことが基本のルール

2. **空行**
    - トップレベルの関数やクラスの間は**２行**ずつ開ける
    - クラス内のメソッド定義は**１行**ずつ開ける

3. **import文**
   - 異なるモジュールはimport文を分ける
   - 次の順番でグループ化する
        1. **標準ライブラリ**
        2. **サードパーティに関連するもの**
        3. **ローカルのライブラリ**
    - **グループ化の区切りには空行が必要**。

4. **空白文字**
   - 余計な空白文字を使わない
   - **代入演算子や比較演算子などの両側**には**１つだけ空白文字**を入れる
   - **カンマの後ろに空白文字**を入れる
   - 閉じカッコなど終わりを表す文字の前には空白文字を入れない

**例：code_layout.py**

### コメント

1. **ブロックコメント**
    - 説明したいコードの前の行に**コードと同じインデント**で書くコメント
        - **コードと同じインデントで書く**
        - **コメント自体は１つの `#` と１つの空白の後ろに書く**

2. **インラインコメント**
    - **コードと同じ行**に書くコメント
    - PEP8では「**インラインコメントは控えめに使いましょう**」とされている
        - コードとコメントの間は**２つ以上のスペース**を書く
        - コメント自体は**１つの`#`と１つのスペースの後ろ**に書く

1. **docstring**
   - モジュール・関数・クラス・メソッドについて説明を書くコメント
      - **関数やメソッドの説明はdefの直後**に書く
      - `"""`で始まり、`"""`で終わる行とする
      - 説明が複数行の場合は、１行目の後に空行を書く

**例：comment.py**

### 命名規約
- Pythonコードの命名において、どの表記法を用いるか定義している

| **用途** | **スタイル** | **用例** |
| --- | --- | --- |
| パッケージとモジュールの名前 | **lowercase** | `system`、`datetime` |
| クラスの名前 | **CamelCase** | `TestCase`、`HTTPRequest` |
| 関数や変数の名前 | **lowercaseまたはlower_case_with_underscores** | `serialize_response` 、`is_connected` |
| 定数 | **UPPERCASEまたはUPPERCASE_WITH_UNDERSCORES** | `MAX_OVERFLOW` 、`TOTAL` |
| 例外の名前 | **CamelCase、末尾にError** | `ClientApiError` |

## 2.2 静的コード解析ツール `Flake8`

- コーディング規約である**PEP8に準拠しているか**、不具合のもとになる箇所がないかを中心に静的コード解析を行う。
- Flake8は以下3つの静的コード解析ツールを１つにまとめたツール

| **名称** | **観点** |
| --- | --- |
| **`pycodestyle`** | **PEP8に準拠しているか**チェック |
| **`Pyflakes`** | 不具合のもとになりそうな箇所がないかチェック |
| **`McCabe`** | コードの複雑さをチェック |

- インストール
```bash
$ pip install flake8
```

- 実行

```bash
$ flake8 実行したいファイル名.py
```

### Flake8のオプション利用

- Flake8はオプションを設定することでチェック内容をカスタマイズできる
    - オプションはコマンドラインでパラメータを渡す方法と、設定ファイルに定義する方法がある。

**オプションの一覧**

| **オプション** | **概要** |
| --- | --- |
| **`ignore`** | 特定のエラーを無視 |
| **`exclude`** | チェックの対象からディレクトリやファイルを除外 |
| **`max-line-length`** | １行の最大文字数を変更 |
| **`max-complexity`** | 複雑度を設定しチェック |

**オプションをコマンドラインで指定**
- 「**`--オプション名`**」と記載する。

**`Ignore`**：
- **無視するエラーコードを指定**、複数のエラーコードを指定する場合はカンマ区切りで指定
``` bash
$ flake8 --ignore=E203,E501
```
- また、ソースコードのインラインコメントに「**`# noqa: エラーコード`**」と書くと、コメントを書いた行でその**エラーコードが検出されなくなる**

**`exclude`**：
- **チェックから除外するファイル名やディレクトリ名のパターン**をカンマ区切りで指定
```bash
$ flake8 --exclude= .env, doc/_build
```

**`max-line-length`**：
- 任意の最大文字数を指定、**デフォルトは79文字**
``` bash
$ flake8 --maxline-length=88
```

**`max-complexity`**：
- Flake8に含まれている**McCabeを有効にする**オプション
  - デフォルトでは無効になっており、**McCabe**は**循環的複雑度**というソフトウェア測定法によって複雑度をチェックする。
- **許容される最大複雑度を数値で指定**できる。
  - 10を超えると一般的には複雑とされている。

```bash
$flake8 --max-complexity= 10
```

**設定ファイルにオプションを定義**
- 上記のオプションは設定ファイルに定義できる。
- 設定ファイルとコマンドラインオプションの両方が指定された場合は**コマンドラインオプションが優先される**
- プロジェクトディレクトリ直下にいずれかのファイルを配置することで有効となる
  - **`setup.cfg`**
  - **`tox.ini`**
  - **`.flake8`**

### プラグインを利用したより便利なflake8の利用

- Flake8には**チェック機能を強化**するプラグインがある

**プラグイン一覧**

| **プラグイン名** | **概要** |
| --- | --- |
| **`flake8-import-order`** | importの順序をチェック |
| **`pep8-naming`** | PEP8の命名規約に準拠しているかチェック |
| **`flake8-commmas`** | カンマの位置をチェック |
| **`flake8-quotes`** | クォートをチェック |
| **`flake8-docstrings`** | docstringの有無や書き方をチェック |
| **`flake8-print`** | print()関数の不要な使用をチェック |

- pipコマンドでプラグインをインストールし、flake8コマンドを実行するだけで、利用可能

**例：flake8.py**

## 2.3 ソースコードの自動整形 `Black`

- **PEP8のコーディング規約をもと**に、**より厳しいルール**でコードを自動整形するツール
- **フォーマットに関するルールを設定で変更することがほぼできない。**

### Blackの特徴

- Blackは**PEPに準拠したスタイルを適用**したうえで、以下のような項目をBlackのルールでフォーマットする
    - 折り返し（改行）の方法や要不要の判断
    - シングルクォートとダブルクォートの使い方
        - **Blackはダブルクォートを使う**

### Blackのオプション
| **主要なコマンドラインオプション** | **概要** |
| --- | --- |
| **`-l、--line-length`** | 1行の**最大文字数**（デフォルト88文字） |
| **`--check`** | ファイルを**チェックし結果を出力**、ファイルの修正はしない。 |
| **`--diff`** | ファイルを**チェックし差分を出力**、ファイルの修正はしない。 |
| **`--include`** | **チェックしたい**ファイルやディレクトリを**正規表現で指定** |
| **`--exclude`** | **除外する**ファイルやディレクトリを**正規表現で指定** |

