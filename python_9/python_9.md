## 9.1 ソート `sorted`、`sort`、`operator`

### `sorted`関数

- イテラブル（リストやタプルなど）を並び替えた**新しいリスト**を返す関数。
    **- 元のデータは変更されない。**

```python
sorted(iterable, key=None, reverse=False)
```

- **引数**
    - **`iterable`**：ソート対象（例：リスト、タプル、文字列、辞書など）
    - **`key`**：並び替えの基準を指定する関数（デフォルトは `None`）
    - **`reverse`**： 降順にするかどうか。`True` にすると降順（デフォルトは `False`）
- **`sorted()` と `list.sort()` の違い**

| **`sorted()`** | **`list.sort()`** |
| --- | --- |
| **新しいリストを返す** | その場で並び替える（返り値は `None`） |
| どんなイテラブルでも使える | リスト専用 |
| イミュータブルなデータも扱える | リストが必要 |

**例：sorted.py**

### `reversed()`関数

- イテラブル（リスト、タプル、文字列など）を「**逆順にする**」ための組み込み関数。

```python
reversed(iterable)
```

- **引数：**
    - `iterable`: 逆順にしたい対象（リスト、タプル、文字列など）
- **戻り値：**
    - `reversed` オブジェクト（＝逆順に要素を取り出せるイテレータ）
- **`reversed()`** は元のリストを変更しない。
- **`reversed()`** と **`sorted(..., reverse=True)`** の違い

| **特徴** | **`reversed()`** | **`sorted(..., reverse=True)`** |
| --- | --- | --- |
| 並び順 | 元の順序を逆にする | 並び替え（ソート）して逆順にする |
| 使い方 | 「そのまま逆にする」時に使う | 「並び替えたあと逆順にする」時に使う |

- ※**`reversed()`** は 一部のイテラブル（例えばジェネレータ）には使えない。

**例：reversed.py**

### リストのsort()、reverse()メソッド

- **`list.sort()`** と **`list.reverse()`** は、Python の **リスト専用のメソッド** 。
    - どちらも **リストの中身を直接変更（破壊的処理）** する。

**`list.sort()` メソッド**
- リストを**昇順（小さい順）に並べ替える**メソッド。

```python
list.sort(key=None, reverse=False)
```

- **特徴：**
    - **元のリストが変更される（破壊的）**
    - 戻り値は **`None`**（**新しいリストは返さない**）
    - `sorted()` より高速（メモリ効率がよい）
- **オプション引数：**
    - `key`：並べ替えの基準になる関数
    - `reverse=True`：降順で並べ替え

**`list.reverse()` メソッド**
- リストの**順序を単純に逆にする**だけのメソッド（ソートはしない）。

```python
list.reverse()
```

- **特徴：**
    - 並び順を**「逆にする」だけ**（大きい順ではない）
    - 元のリストが**直接変更**される
    - 戻り値は `None`

- **比較：`sort()` vs `reverse()` vs `sorted()` vs `reversed()`**

| **機能** | **`sort()`**| **`reverse()`** | **`sorted()`** | **`reversed()`** |
| --- | --- | --- | --- | --- |
| 対象 | リストのみ | リストのみ | イテラブル全般 | イテラブル全般 |
| 処理内容 | 昇順ソート | 逆順に並び替え | ソートして新リスト | 逆順のイテレータ |
| 破壊的 |上書き | 上書き | 非破壊| 非破壊|
| 戻り値 | `None` | `None` | 新しいリスト | reversed オブジェクト |

**例：list_sort.py**

### key引数

- **並び替えの基準を指定するための関数**を渡す引数。
    - **`sorted()`** や **`list.sort()`** でよく使われる。
- 通常のソートは「数値の大小」や「文字列のアルファベット順」で行われるが、`key` を使うと「**その値をどう変換した上で比べるか**」を指定できる。

```python
sorted(iterable, key=関数)
```
または
```python
list.sort(key=関数)
```
**例：key_param.py**

### `operator`モジュール

- `operator` モジュールは、**関数ベースで標準的な演算や属性・要素へのアクセスを提供**してくれる便利ツール。

**`operator.itemgetter`**：（辞書・タプル・リストなどの要素に使う）
- これは「指定したキー（インデックス）に対応する**要素**を取り出す関数」を作る

**例：itemgetter.py**

**`operator.attrgetter`（オブジェクトの属性に使う）**
- これは「指定した**属性（プロパティ）を取り出す関数**」を作る。
**例：attrgetter.py**

**使い分け**

| **ソート対象** | **使用関数** |
| --- | --- |
| 辞書 | **`itemgetter('key')`** |
| タプル | **`itemgetter(index)`** |
| クラスの属性 | **`attrgetter('attr')`** |

## 9.2 様々なコンテナー型を扱う `collections`

- Pythonの`collections`モジュールは、標準のPythonのデータ構造（リスト、辞書、タプルなど）を拡張するための
便利なクラスや関数が含まれているモジュール

### データの件数をカウントする **`Counter`**

- `Counter`は**イテラブル内の要素の出現回数をカウント**するためのクラス。
    - **辞書**のように使えるが、自動で数を数えてくれるのが特徴。

**Counterオブジェクトのメソッド**

- **`elements()`**
    - **出現回数分、要素を繰り返すイテレータ**を返すメソッド。
    - **ポイント：**
      - 回数が0以下の要素はスキップされる
      - 結果はイテレータ（順序は保証されない）

- **`most_common([n])`**
  - **出現頻度の高い順に要素とそのカウントを返す**メソッド。
  - **ポイント：**
    - 引数なし → 全てを多い順に返す
    - 引数あり → 上位`n`個だけ返す

- **`subtract([iterable-or-mapping])`**
    - **指定した要素の回数を引き算する**メソッド。
    - **ポイント：**
      - 値がマイナスになる可能性もある（0未満でも保持）
      - 元の **`Counter`** を **破壊的に変更**

- **`update([iterable-or-mapping])`**
    - **指定した要素の回数を加算する**メソッド。
    - **ポイント：**
      - **`iterable`**（例: リストや文字列）でも使える
      - 元のCounterを**破壊的に変更**

- `collections.Counter` は辞書のように見えて、実は**数値演算ができる特殊なオブジェクト**
    - **四則演算的な操作**がサポートされている。

| 演算子 | 操作名 | 説明 |
| --- | --- | --- |
| `+` | 加算 | 同じキーの値を足し合わせる（0以下は除外） |
| `-` | 減算 | 同じキーの値を引く（0以下は除外） |
| `&` | 積（AND） | 各キーに対して**小さい方の値**（共通部分） |
| `\|` | 和集合（OR） | 結合された要素について、元の Counter オブジェクト間でカウントを比較し、**大きい方の値**を採用
- **※注意点**
    - **結果**に**0以下の値は含まれない**（演算後に自動的に除去される）
    - `Counter`は**負の値も保持できる**が、演算での出力には含まれない（`+` や  では省かれる）

**例：Counter.py**

### デフォルト値を持った辞書 `defaultdict`

- `defaultdict` は、**辞書（`dict`）の便利な拡張版**。
    - 通常の辞書にない「**キーが存在しないときのデフォルト値の自動生成**」という機能がある
- 通常の辞書では、存在しないキーを参照すると `KeyError` になる
  - `defaultdict`を使うと、**指定した型の初期値を自動的に作ってくれる**ので、**`KeyError`にならずに済む**

```python
from collections import defaultdict

dd = defaultdict(default_factory)
```

- `default_factory`：値のデフォルトを生成する関数（例：`int`, `list`, `str`など）

- defaultdict vs dict

| 特徴 | `dict` | `defaultdict` |
| --- | --- | --- |
| 未定義キーの参照 | `KeyError` | 自動でデフォルト生成 |
| 使いどころ | 汎用 | カウント・分類処理など |
| デフォルトの指定 | できない | `default_factory`で指定可 |

**例：defaultdict.py**

### データの挿入順を維持する辞書 `OrderedDict`

- `collections.OrderedDict` は、Python の標準辞書（`dict`）に**順序の保持機能**を追加した特別な辞書。
- 通常の `dict` は **Python 3.7以降**では挿入順を保持するが、
- `OrderedDict` は Pythonのバージョンにかかわらず**順序保持が正式にサポートされた**専用クラスです。
- 「順番が重要な辞書」を明示的に使いたいときに役立つ。
```python
collections.namedtuple(typename, field_names, *, rename=False, defaults=None, module=None)
```

- **主な特徴**

| 特徴 | 説明 |
| --- | --- |
|  順序保持 | 追加された順番を覚えている |
| 再ソートができる（`move_to_end`） | 要素の順番を動かせる |
| 反転可能（`reversed()`） | 順番を逆にできる |

- **`OrderedDict` vs `dict`**

| 比較項目 | `dict`（Py3.7+） | `OrderedDict` |
| --- | --- | --- |
| 挿入順の保持 | はい | はい |
| 順番の操作 | できない | `move_to_end()` など可能 |
| 明示的な順序が必要な用途 | 使いづらい | 適している |
  
#### **メソッド**
- **`move_to_end(key, last=True)`**
    - 指定したキーを「最後（`last=True`）」または「先頭（`last=False`）」に移動する。
      - `last`引数を指定しなかった場合、**デフォルトでTrue**として扱われる
- **`popitem(last=True)`**
    - `last=True` ： 最後の要素を取り出す
    - `last=False` ：最初の要素を取り出す
      - `last`引数を指定しなかった場合、**デフォルトでTrue**として扱われる

**例：OrderedDict.py**

### 名前付きフィールドを持つタプル `namedtuple`

- **`collections.namedtuple`** は、**名前付きのタプル**を作るためのクラス
- 通常のタプルは**位置でアクセス**する
  - （例：`person[0]`）
- `namedtuple`は**フィールド名でアクセス可能**なタプルを生成し、可読性アップ＆イミュータブル（変更不可）という特徴がある。

- **引数**

| 引数名 | 種類 | 説明 |
| --- | --- | --- |
| **`typename`** | 必須 (文字列) | 作成するnamedtupleの**クラス名**。大文字から始まる名前が一般的。 |
| **`field_names`** | 必須 (リストまたは文字列) | フィールド名（属性名）のリストか、スペースやカンマ区切りの文字列。 |
| **`rename`** | キーワード引数 (bool) | Trueなら無効なフィールド名を `_0`, `_1` のように自動リネームする（デフォルトはFalse） |
| **`defaults`** | キーワード引数 (イテラブル) | フィールドのデフォルト値。指定した分だけ**末尾のフィールドに割り当て**られる（Python3.7+） |
| **`module`** | キーワード引数 (文字列) | クラスの `__module__` 属性を指定。主にPickleなどのシリアライズで使う。 |

- **特徴**

| ポイント | 説明 |
| --- | --- |
| フィールド名でアクセス | `p.name`のように書ける |
| イミュータブル（不変） | 値の変更はできない（タプルと同じ） |
| 軽量 | クラスよりメモリ効率が良い |
| イテラブル | for文などで展開できる |

#### **メソッド**
- **`_replace(**kwargs)`**
    - 新しい値に置き換えた**新しいnamedtupleを返す**（元は変更されない）
- **`_asdict()`**
    - フィールド名をキーとする辞書を返す
- **`_fields`**
    - フィールド名のタプルを返す

**例：namedtuple.py**

## 9.4 列挙型による定数の定義を行う **`enum`**

#### `enum` モジュール
- `enum`（列挙型）は、**意味のある定数値をグループで定義するための仕組み**。
    - たとえば、曜日・状態・種類などを、**わかりやすい名前で管理**できる。

**定数値を定義する**
- 基本的な書き方はクラス定義に似ている。
```python
from enum import Enum

class Color(Enum):
    RED = 1
    GREEN = 2
    BLUE = 3

```
- **ポイント**
    - `Enum` を継承してクラスを作成
    - メンバー（定数）をクラス変数として定義
    - 値（ここでは 1, 2, 3）は一意である必要がある
    - 値に「**`enum.auto()`**」を使うと、各定数に連番をふれる
    - クラスデコレーター「**`@enum.unique`**」を指定した列挙型は、複数の定数に同じ値を設定できなくなる。

**定数同士を比較する**
- `Enum` メンバー同士は **同じクラスの中であれば比較可能**
    - **異なる `Enum` 同士の比較はできない**

**例：enum_module.py**

## 9.6 イテレーターの組み合わせで処理を組み立てる `itertools`

- `itertools` モジュールは、**イテレータ（繰り返し処理）を便利に扱うためのツール群**を提供する、Python 標準ライブラリのひとつ

**イテラルオブジェクトとイテレーターの違い**

| **項目** | **イテラブル（Iterable）** | **イテレーター（Iterator）** |
| --- | --- | --- |
| **役割** | 繰り返し可能な対象 | 実際に要素を1つずつ取り出す役 |
| **例** | リスト、文字列など | `iter(リスト)` など |
| **メソッド** | `__iter__()` | `__iter__()` と `__next__()` |
| **`next()`使用可** | ❌（直接は不可） | ✅ |
| **使い捨てか** | 再利用可能 | 基本的に1回限り |

#### イテラルオブジェクトを連結する `chain()`
- `chain()` は、複数のイテラブル（リスト、タプル、文字列など）を**一列に連結**して、1つのイテレータとして扱えるようにする。

**書式と引数**
```python
itertools.chain(*iterables)
```

| 引数 | 説明 |
| --- | --- |
| `*iterables` | 連結したい複数のイテラブル（可変長引数） |

**例:itertools_module.py**

#### 連続する値をまとめる **`groupby()`**

- **`groupby()`** は、**隣接する同じ値**（または条件に一致する値）をグループ化する。
    - ※ `sorted()` との併用がよく行われる（そうでないと連続しない）
- **書式と引数**
```python
itertools.groupby(iterable, key=None)
```

| 引数 | 説明 |
| --- | --- |
| `iterable` | イテラブル（例：リストなど） |
| `key` | グループ分けのための関数（lambdaなど）。省略時はそのまま比較。 |

**例：groupby.py**

#### イテレーターから範囲を指定して取得する `islice()`

- **`islice()`** は、**イテラブルの一部分（スライス）を取り出す**ための関数。
- 普通のリストのスライス (`list[start:stop:step]`) に似ているが、**イテレータにも使える**のが大きな違い。

```python
from itertools import islice

islice(iterable, stop)
islice(iterable, start, stop[, step])
```

- **引数**

| 引数 | 意味 |
| --- | --- |
| **`iterable`** | 対象となるイテラブル（リスト・ジェネレータなど） |
| **`start`** | 開始位置（0始まり） |
| **`stop`** | 終了位置（この位置の手前で止まる） |
| **`step`** | 間引き間隔（省略可） |

※ `step` を指定すると `range(start, stop, step)` のような動作になる。

**`islice` vs 普通のスライスの違い**

| 特徴 | 普通のスライス (`x[start:stop]`) | `itertools.islice()` |
| --- | --- | --- |
| リストに使えるか | ✅ | ✅ |
| イテレータに使えるか | ❌（エラー） | ✅（逐次処理可能） |
| メモリ効率 | 全体を展開 | スライス部分だけ評価 |
| 無限列対応 | ❌ | ✅ |

---

**例：islice.py**

#### 複数のイテラルオブジェクトの要素からタプルを作成する `zip() zip_longest()`

- `zip()` と `itertools.zip_longest()` は、**複数のイテラブル（リスト・タプルなど）を並行に処理する**ときに使う便利な関数。

**`zip()` 関数（標準関数）**
- 複数のイテラブルの要素を「対応させて」タプルにまとめる。
    - **最短の長さにそろえて打ち切る**。

```python
zip(iter1, iter2, ...)
```

**`itertools.zip_longest()`（全要素を揃えたい場合）**

```python
from itertools import zip_longest
```

- `zip()` と同じようにタプルを作るが、**長さの足りない部分を埋めてくれる**。

```python
zip_longest(iter1, iter2, ..., fillvalue=None)
```

| **引数** | **意味** |
| --- | --- |
| `*iters` | 複数のイテラブル |
| `fillvalue` | 足りない要素を埋める値（デフォルトは `None`で埋める） |

**`zip()` vs `zip_longest()` 比較**

| 機能 | `zip()` | `zip_longest()` |
| --- | --- | --- |
| 動作 | 短い方に合わせて打ち切り | 長い方に合わせて埋める |
| 足りない要素 | 無視される | `fillvalue` で補完される |
| 用途 | 要素数が等しい前提の処理 | 要素数が異なるデータを扱うとき |

---

- **例：zip_zip_longest.py**

#### データを組み合わせたイテレーターを取得する
**`itertools.product()`（直積）**
- 複数のイテラブルから、全ての組み合わせ（直積）**を生成する。
- **順序:** 考慮される
  - `('A', 'B')`と`('B', 'A')`は**別の結果**と見なされる
- **重複:** 許される
  - `('A', 'A')`のような組み合わせも生成される
```python
itertools.product(*iterables, repeat=1)
```
| 引数 | 説明 |
| --- | --- |
| `*iterables` | 組み合わせを作りたいイテラブル |
| `repeat` | 同じイテラブルを何回繰り返すか（デフォルト：1） |

**`itertools.permutations()`（順列）**
- 与えられたイテラブル（リスト、文字列、タプルなど）の要素の **すべての可能な順列（並び替え）** を生成
- **順序:** 考慮される
  - `('A', 'B')`と`('B', 'A')`は**別の結果**と見なされる
- **重複:** 許されない
```python
itertools.permutations(iterable, r=None)
```

| 引数 | 説明 |
| --- | --- |
| `iterable` | 元の要素 |
| `r` | 長さ r の順列。省略時は全体（`=len(iterable)`） |

**`itertools.combinations()`（組み合わせ）**
- **順番を考慮せずに** r 個選ぶすべての方法を生成する（重複なし）
- **順序**: 考慮されない
  - `('A', 'B')`と`('B', 'A')`は**同じ結果**と見なされ、1つだけ出力される
  - 要素は常に**辞書順（昇順）**で出力される
- **重複**: 許されない
```python
itertools.combinations(iterable, r)
```

| 引数 | 説明 |
| --- | --- |
| `iterable` | 元データ |
| `r` | 選ぶ個数 |

**`itertools.combinations_with_replacement()`（重複ありの組み合わせ）**
- **同じ要素を複数回選んでもよい**組み合わせ
    - （例：硬貨3枚で100円にするパターンなど）
- 順序: 考慮されない
  - `combinations`と同様、結果は常に**辞書順（昇順）**で出力される
- 重複: 許される
    - `('A', 'A')`のような組み合わせも生成される
```python

itertools.combinations_with_replacement(iterable, r)
```

| **関数** | **順序** | **重複** | **結果の例** | **違いのポイント** |
| --- | --- | --- | --- | --- |
| `permutations` | ✅ 有り | ❌ なし | `('A', 'B')`, `('B', 'A')` | `('A', 'B')`と`('B', 'A')`を区別する。 |
| `combinations` | ❌ なし | ❌ なし | `('A', 'B')` | **順序を区別しない**ため、`('A', 'B')`だけが残る。 |
| `product` | ✅ 有り | ✅ 有り | `('A', 'A')`, `('A', 'B')`, `('B', 'A')`, `('B', 'B')` | `('A', 'A')`や`('B', 'B')`など、**同じ要素の繰り返し**を許容する。 |
| `combinations_with_replacement` | ❌ なし | ✅ 有り | `('A', 'A')`, `('A', 'B')`, `('B', 'B')` | **順序を区別せず**、**重複を許容**する。 |

**itertools_method.py**

## 9.7 ミュータブルなオブジェクトをコピーする `copy`

- Pythonでは変数への代入はオブジェクトをコピーしない
    - 変数名でオブジェクトへの参照が作成されるだけ
    - イミュータブル（不変）なオブジェクトでも同様
- ミュータブル（可変）なオブジェクトに代入して値の修正や追加をすると、**参照元のオブジェクトに値の修正や追加が行われる。**
#### 浅いコピーを行う `copy()`関数

**`copy.copy()`**
- イメージ：
    - 📦 一番外側の箱だけコピーするけど、
    - 📦📦 中の箱は**元と同じもの**を使い回す。
- 1階層のリストなら安全だが、階層が増えると共有してしまう
**例：copy_copy.py**

#### 深いコピーを行う　`deepcopy()`関数
**`copy.deepcopy()`**
- **イメージ**
    - 📦 全部の箱を**中まで完全コピー**して、
    - **元のオブジェクトとは完全に独立**したものを作る

**例：copy_deepcopy.py**

**図で理解する（イメージ）**
```
a = [1, 2, [3, 4]]

   ┌──┬──┬──────────┐
a: │1 │2 │ ┌──────┐ │
   └──┴──┴─▶│ 3 , 4│
            └──────┘

copy.copy(a):
   ┌──┬──┬──────────┐
b: │1 │2 │ ┌──────┐ │ ← 同じ[3, 4]を参照！

copy.deepcopy(a):
   ┌──┬──┬──────────┐
c: │1 │2 │ ┌──────┐ │ ← 中の[3, 4]もコピー！
```

| **状況** | **推奨するコピー方法** |
| --- | --- |
| 数字・文字列だけのリストや辞書 | `copy.copy()`（浅くてOK） |
| ネストされたリスト・辞書 | `copy.deepcopy()` |
| 複製しても中の変更が反映されていい場合 | `copy.copy()` |
| 完全に独立したコピーが必要な場合 | `copy.deepcopy()` |